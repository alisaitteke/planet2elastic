<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Planet2elastic by erikschlegel</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Planet2elastic</h1>
      <h2 class="project-tagline">Pushes a set of OpenStreetMap planet files to an ElasticSearch Geo Tile Cluster</h2>
      <a href="https://github.com/erikschlegel/planet2elastic" class="btn">View on GitHub</a>
      <a href="https://github.com/erikschlegel/planet2elastic/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/erikschlegel/planet2elastic/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="planet-2-elastic" class="anchor" href="#planet-2-elastic" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Planet 2 Elastic</h1>

<p>Pushes a set of OpenStreetMap planet files to an Tile Based Elastic Index. You can grab planet files at <a href="http://download.geofabrik.de/">GeoFabrik</a>. This will parse all binary pbf files and index all nodes and ways within their respective tile quadkey location. The end result is an elastic document that looks like the following. Document index convention follows {QuadKey}-{OsmId}</p>

<pre><code>{
        "_index": "places",
        "_type": "place",
        "_id": "1202033221320231-100149001",
        "_score": 1,
        "_source": {
          "osmId": "100149001",
          "type": "way",
          "name": "FC Berwangen",
          "coordinates": {
            "type": "multilinestring",
            "coordinates": [
              [
                [
                  8.98524,
                  49.186888
                ],
                [
                  8.98611,
                  49.186606
                ],
                [
                  8.985465,
                  49.185754
                ],
                [
                  8.984595,
                  49.186035
                ],
                [
                  8.98524,
                  49.186888
                ]
              ]
            ]
          },
          "location": {
            "lat": 49.186434,
            "lon": 8.98533
          },
          "quadKey": "1202033221320231",
          "id": "1202033221320231-100149001"
        }
      }
</code></pre>

<h2>
<a id="setup" class="anchor" href="#setup" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setup</h2>

<p>Please complete the following steps before you kickoff the elastic indexing. This assumes you have some general familiarity with elasticsearch. Please refer to this <a href="https://gist.github.com/erikschlegel/0f4330009c7c5ae83831889609a8bb7c">Gist</a> if you have an Azure subscription and in need of a cloud-based elastic cluster.</p>

<h3>
<a id="environment-settings" class="anchor" href="#environment-settings" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Environment Settings</h3>

<p>Setup the following environment variables to specify the destination elastic cluster. This assumes your elastic cluster has basic authentication enabled, via <a href="https://www.elastic.co/guide/en/shield/current/enable-basic-auth.html">Shield</a>.</p>

<ul>
<li>ES_HOST: my-elasticbeast.azure.cloud.com</li>
<li>ES_PORT: 9200</li>
<li>ES_AUTH_USER: my-username</li>
<li>ES_AUTH_PWD: mypassword</li>
</ul>

<p>Provide the directory location for your planet(.pbf) files  </p>

<ul>
<li>PBF_DIRECTORY: /pbfsource</li>
</ul>

<h3>
<a id="setup-elastic-indexes" class="anchor" href="#setup-elastic-indexes" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Setup Elastic Indexes</h3>

<p>Create two new indexes. To create a new index in elastic you provide a PUT request using a tool like <a href="https://www.getpostman.com/">POSTMON</a> with the request URL following the convention ES_HOST:ES_PORT/ES_INDEX_NAME</p>

<ul>
<li>places: <a href="https://github.com/erikschlegel/pbftoelastic/blob/master/indexes/places.json">places index defintion</a>
</li>
<li>tiles: <a href="https://github.com/erikschlegel/pbftoelastic/blob/master/indexes/tiles.json">tiles index definition</a>
</li>
</ul>

<h2>
<a id="import" class="anchor" href="#import" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Import</h2>

<h3>
<a id="configuration" class="anchor" href="#configuration" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Configuration</h3>

<p>The mapping features that this framework imports from Openstreetmap is managed in <a href="https://github.com/erikschlegel/Planet2Elastic/blob/master/featureTags.js">featureTags.js</a>. Feel free to add/remove the data attributes relevant for your scenario(s).</p>

<h3>
<a id="run-importer" class="anchor" href="#run-importer" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Run Importer</h3>

<pre><code>npm install
npm run import
</code></pre>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/erikschlegel/planet2elastic">Planet2elastic</a> is maintained by <a href="https://github.com/erikschlegel">erikschlegel</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
